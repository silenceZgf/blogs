# Perl 文件操作
> Perl 对文件和目录操作提供了相关的增删改查API, 如rename, rmdir, unlink 等函数, 但是笔者认为并没有太大必要去花时间掌握这些函数, 因为perl 通过system 函数可以直接执行系统命令, 所以直接使用system+原生linux文件操作命令即可, 这样可以少学一套API. 因此, 笔者更常用于此种方式.


#1. 文件内容-文件读写

## 1.1 读文件

## 1.2 写文件


# 2. 文件检测

## 2.1 常用文件操作符
* perl 提供了很多用于文件判断的操作符, 笔者只列出个人常用的文件操作符:

### 2.1.1 判断文件权限
| 测试操作符 | 含义 |
| :--- | :--- |
| -r | 当前用户对此文件是否拥有可读权限 |
| -w | 当前用户对此文件是否拥有可写权限 |
| -x | 当前用户对此文件是否拥有可执行权限 |
| -o | 此文件所有者是否是当前用户 |

### 2.1.2 判断文件类型
| 测试操作符 | 含义 |
| :--- | :--- |
| -f | 文件是否是普通文件 |
| -d | 文件是否是目录文件 |
| -l | 文件是否是链接文件 |

### 2.1.3 判断文件存在
| 测试操作符 | 含义 |
| :--- | :--- |
| -e | 文件或目录存在 |
| -z | 判断文件内容为空,不能用于判断目录 |
| -s | 判断文件或目录存在, 返回文件或目录的大小, 单位为字节 |

## 2.2 文件操作符组合
* 通常我们可能会对同一个文件的多个属性进行判断, 那么就需要组合文件操作符

### 2.2.1 逻辑表达式组合
* perl 可以使用and 和 or 表示逻辑与和逻辑或的关系
* 隐式文件句柄 _ 表示上次监测的文件, 用于提升效率

```perl
if ( -f $file and -x _ ) {
   print "文件$file 存在且可执行\n";
}
```

### 2.2.2 栈式组合
* 栈操作符只能表示逻辑与关系, 使用起来很方便

```perl
if( -f -x $file){
   print "文件$file 存在且可执行\n";
}
```

# 3. 文件夹操作
* perl语言中对文件夹和文件操作是很简单的, 通常只要拿到文件绝对路径名称即可, 然后使用系统命令对文件进行增删改查即可.

## 3.1 获取目录下所有文件
* perl 获取目录下所有文件操作是极其简单的,简直不能再简单了
* 通过砖石操作符获取的只是文件名, 返回文件名为局对路径文件名
* 支持shell的通配符, 如*, ?, []等

```perl
# 语法: <目录名/*>, 支持shell的通配符, 如: @plfiles=<$dir/*.pl>; 或 @files=<$dir/*>K;

#输出home目录下所有文件
$dir="/home";
@files=<$dir/*>;
print "$_\n" foreach @files;

```

## 3.2 递归文件夹
### 3.2.1 普通方式

```perl
#!/usr/bin/perl

#递归函数
sub recure{
  #获取传入参数:文件名
  my $file = shift @_;

  #判断文件是否是目录
  if( -d $file ){
     #文件是目录, 则文件夹数量+1
     $cnt_dir++;

     #获取文件夹下所有文件
     my @sub_files = <$file/*>;
     
     #遍历所有文件, 递归方法 
     foreach my $sub_file (@sub_files ){
        &recure($sub_file);
     }
   }else {
     #如果文件是普通文件,则文件数量+1
     $cnt_file++;
   }
}

$dir = "/home/admin/blog";
&recure($dir);
print "files:$cnt_file, dirs:$cnt_dir\n";

```

### 3.2.2 极简方式
* 从简化模式可以看出, perl是非常灵活的

```perl
#!/usr/bin/perl

#递归函数
sub recure{
  #获取传入参数:文件名
  my $file = shift @_;

  #判断文件是否是目录
  if( -d $file ){
     #文件是目录, 则文件夹数量+1
     $cnt_dir++;

     #遍历所有文件, 递归方法 
     &recure($_) foreach <$file/*>;
   }else {
     #如果文件是普通文件,则文件数量+1
     $cnt_file++;
   }
}

$dir = "/home/admin/blog";
&recure($dir);
print "files:$cnt_file, dirs:$cnt_dir\n";
```









